  ## å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ ¸å¿ƒç™»å½• API - routes/api/auth/login.ts
### 2. MFA éªŒè¯ API - routes/api/auth/mfa/verify/index.ts
### 3. MFA çŠ¶æ€æ£€æŸ¥ API - routes/api/auth/mfa/status/index.ts
### 4. æ³¨å†Œè¡¨å• - islands/RegisterForm.tsx

  - âœ… å¤šæ­¥éª¤æ³¨å†Œæµç¨‹
  - âœ… é‚®ç®±éªŒè¯ç éªŒè¯
  - âœ… è‡ªåŠ¨ç™»å½•
  - âœ… **æ³¨å†ŒæˆåŠŸåæ€»æ˜¯é‡å®šå‘åˆ° MFA è®¾ç½®é¡µé¢**

### 5. è¿è¡Œæ—¶é…ç½®åŠ è½½å™¨ - config/runtime-loader.ts

  - âœ… çº¯ Deno å®ç°
  - âœ… æ”¯æŒ SIT/PROD ç¯å¢ƒåˆ‡æ¢
  - âœ… æ”¯æŒå¤šåŒºåŸŸé…ç½®
  - âœ… ç¯å¢ƒå˜é‡è¦†ç›–
  - âœ… é…ç½®ç¼“å­˜

  ğŸ“Š å®Œæ•´çš„æµç¨‹è¯´æ˜

  ### æ³¨å†Œæµç¨‹ (RegisterForm.tsx)

  1. ç”¨æˆ·å¡«å†™é‚®ç®±å’Œå¯†ç 
  2. è¯·æ±‚å‘é€éªŒè¯ç ï¼šPOST /api/auth/register/send
  3. ç”¨æˆ·è¾“å…¥éªŒè¯ç 
  4. éªŒè¯é‚®ç®±ï¼šPOST /api/auth/register/verify
  5. å®Œæˆæ³¨å†Œï¼šPOST /api/auth/register
  6. è‡ªåŠ¨ç™»å½•ï¼šPOST /api/auth/login
  7. **æ³¨å†ŒæˆåŠŸåï¼Œæ€»æ˜¯é‡å®šå‘åˆ° `/panel/account?NeedSetupMfa=1`**
  8. ç”¨æˆ·å¯ä»¥åœ¨ MFA è®¾ç½®é¡µé¢é€‰æ‹©å¯ç”¨æˆ–è·³è¿‡ MFA

### ç™»å½•æµç¨‹

  **é‡è¦è¯´æ˜**ï¼š
  - `é¦–æ¬¡ç™»å½• /panel/account?NeedSetupMfa=1` çš„é‡å®šå‘
  - æ—¥å¸¸ç™»å½•æ—¶ï¼Œå¦‚æœéœ€è¦ TOTPï¼Œè¿”å› `needMfa: false` + `error: 'mfa_code_required'`

åç«¯ API è·¯å¾„æ˜ å°„

  | Fresh API                 | åç«¯ API
  | è¯´æ˜        |
  |---------------------------|-------------------------------------|-
  ----------|
  éªŒè¯ MFA ä»£ç  |

ğŸ“ æ—¥å¿—è¾“å‡ºç¤ºä¾‹

  æ³¨å†Œæµç¨‹æ—¥å¿—ï¼š

  MFA çŠ¶æ€æ£€æŸ¥æ—¥å¿—ï¼š

  MFA éªŒè¯æ—¥å¿—ï¼š

