service: cloud_sql
environment: dev
module:
  name: postgres
  source: terraform-google-modules/sql-db/google
  version: "~> 13.0"
inputs:
  project_id: xcontrol-dev-data
  region: us-central1
  database_version: POSTGRES_14
  tier: db-custom-2-4096
  availability_type: REGIONAL
  deletion_protection: true
  storage_auto_resize: true
  backup_configuration:
    enabled: true
    point_in_time_recovery_enabled: true
    backup_retention_settings:
      retained_backups: 7
      retention_unit: COUNT
  ip_configuration:
    ipv4_enabled: false
    private_network: dev-shared-vpc
    require_ssl: true
  user:
    name: app_owner
    password_secret: projects/xcontrol-dev-data/secrets/sql-app-owner
  database:
    name: app_db
    charset: UTF8
    collation: en_US.UTF8
  maintenance_window:
    day: 7
    hour: 22
labels:
  environment: dev
  owner: data-team
