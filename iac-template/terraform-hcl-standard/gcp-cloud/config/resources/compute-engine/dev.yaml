service: compute_engine
environment: dev
module:
  name: compute-mig
  source: terraform-google-modules/vm/google//modules/mig
  version: "~> 13.0"
inputs:
  project_id: xcontrol-dev-apps
  region: us-central1
  target_size: 2
  instance_template:
    machine_type: e2-standard-4
    source_image_family: debian-12
    disk_size_gb: 50
    disk_type: pd-balanced
    service_account_email: runtime@xcontrol-dev-apps.iam.gserviceaccount.com
    tags:
      - web
      - internal
    metadata:
      enable-oslogin: "TRUE"
    labels:
      tier: web
  autoscaler:
    min_replicas: 2
    max_replicas: 6
    cooldown_period: 120
    cpu_utilization_target: 0.65
  network:
    network: dev-shared-vpc
    subnetwork: dev-apps-a
    create_firewall_rules: false
  health_check:
    type: HTTP
    port: 8080
    request_path: /healthz
labels:
  environment: dev
  owner: app-team
